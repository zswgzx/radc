# Generated by Neurodocker version 0.6.0
#     https://github.com/kaczmarj/neurodocker

FROM ubuntu:18.04

ARG DEBIAN_FRONTEND="noninteractive"

RUN apt-get update -qq \
    && apt-get install -yq --no-install-recommends \
           wget \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/* \
    && chmod 777 /opt && chmod a+s /opt

ENV ANTSPATH="/opt/ants-2.3.2" \
    PATH="/opt/ants-2.3.2/bin:$PATH"
RUN echo "Downloading ANTs ..." \
    && cd opt \
    && wget --no-check-certificate --progress=bar:force https://dl.dropbox.com/s/hrm530kcqe3zo68/ants-Linux-centos6_x86_64-v2.3.2.tar.gz \
    && tar xfz ants-Linux-centos6_x86_64-v2.3.2.tar.gz;rm ants-Linux-centos6_x86_64-v2.3.2.tar.gz;mv ants ants-2.3.2;cd $ANTSPATH \
    && rm -f $ANTSPATH/bin/[cisw]* $ANTSPATH/bin/ants* $ANTSPATH/bin/[ACDEFGIKLMPRSTW]* $ANTSPATH/lib/libl_[ACDEFGIKLMPRSTWacis]* \
    && find $ANTSPATH/bin -name "*.sh" -delete \
    && find $ANTSPATH/bin -name "*.R" -delete

RUN echo '#!/usr/bin/env bash' >> /opt/n4.sh \
    && echo 'set -e' >> /opt/n4.sh \
    && echo 'if [ -n "$1" ]; then N4BiasFieldCorrection -d 3 -s 2 -c [50x50x50x50,1e-9] -b [200] -i /input/$1.nii.gz -o /input/$1-n4.nii.gz;else N4BiasFieldCorrection;fi' >> /opt/n4.sh \
    && chmod +x /opt/n4.sh

ENTRYPOINT ["/opt/n4.sh"]
